<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Онлаин конструктор Футболок</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/fabric.js"></script>
	<link type="text/css" rel="stylesheet" href="css/jquery.miniColors.css" />
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
	<link rel="shortcut icon" href="https://copymaster.biz/img/favicon.ico" /> </head>
	<link type="text/css" rel="stylesheet" href="css/app.css" />

<body class="preview" data-spy="scroll" data-target=".subnav" data-offset="80">
	<div class="container">
		<div class="row"> <a href=""> Вернуться на сайт</a> </div>
	</div>
	<div class="container">
		<section id="typography">
			<div class="page-header">
				<div class="row text-center">
					<h1 class="text-center" style="text-align: center;">Конструктор Футболок</h1> </div>
			</div>
			<div class="row justify-content-center">
				<div class="span4">
					<div> </div>
					<div class="tabbable">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#tab2" data-toggle="tab">Настройки</a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane " id="tab1">
								<div class="well">
									<select id="tshirttype">
										<option value="img/crew_front.png" selected="selected">Short Sleeve Shirts</option>
										<option value="img/mens_longsleeve_front.png">Long Sleeve Shirts</option>
										<option value="img/mens_hoodie_front.png">Hoodies</option>
										<option value="img/mens_tank_front.png">Tank tops</option>
									</select>
								</div>
								<div class="well">
									<ul class="nav">
										<li class="color-preview" title="White" style="background-color:#ffffff;"></li>
										<li class="color-preview" title="Dark Heather" style="background-color:#616161;"></li>
										<li class="color-preview" title="Gray" style="background-color:#f0f0f0;"></li>
										<li class="color-preview" title="Charcoal" style="background-color:#5b5b5b;"></li>
										<li class="color-preview" title="Black" style="background-color:#222222;"></li>
										<li class="color-preview" title="Heather Orange" style="background-color:#fc8d74;"></li>
										<li class="color-preview" title="Heather Dark Chocolate" style="background-color:#432d26;"></li>
										<li class="color-preview" title="Salmon" style="background-color:#eead91;"></li>
										<li class="color-preview" title="Chesnut" style="background-color:#806355;"></li>
										<li class="color-preview" title="Dark Chocolate" style="background-color:#382d21;"></li>
										<li class="color-preview" title="Citrus Yellow" style="background-color:#faef93;"></li>
										<li class="color-preview" title="Avocado" style="background-color:#aeba5e;"></li>
										<li class="color-preview" title="Kiwi" style="background-color:#8aa140;"></li>
										<li class="color-preview" title="Irish Green" style="background-color:#1f6522;"></li>
										<li class="color-preview" title="Scrub Green" style="background-color:#13afa2;"></li>
										<li class="color-preview" title="Teal Ice" style="background-color:#b8d5d7;"></li>
										<li class="color-preview" title="Heather Sapphire" style="background-color:#15aeda;"></li>
										<li class="color-preview" title="Sky" style="background-color:#a5def8;"></li>
										<li class="color-preview" title="Antique Sapphire" style="background-color:#0f77c0;"></li>
										<li class="color-preview" title="Heather Navy" style="background-color:#3469b7;"></li>
										<li class="color-preview" title="Cherry Red" style="background-color:#c50404;"></li>
									</ul>
								</div>
							</div>
							<div class="tab-pane active" id="tab2">
								<div class="well">
									<div class="input-append">
										<input class="span2" id="text-string" type="text" placeholder="Введите текст">
										<button id="add-text" class="btn" title="Add text"><i class="icon-share-alt"></i> Добавить</button>
										<hr> </div>
									<div id="avatarlist"> <img style="cursor:pointer;" class="img-polaroid" src="img/invisibleman.jpg"> </div>
									<div>
										<hr>
										<input type="file" accept="image/*"> <a href="#" class="upload_files btn btn-primary">Добавить свою картинку</a> <img id="blah" src="#" alt="your image" class="img-polaroid2" style="display:none" />
										<div class="ajax-reply"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="span6">
					<div align="center" style="min-height: 32px;">
						<div class="clearfix">
							<div class="btn-group inline pull-left" id="texteditor" style="display:none">
								<button id="font-family" class="btn dropdown-toggle" data-toggle="dropdown" title="Шрифт"><i class="icon-font" style="width:19px;height:19px;"></i></button>
								<ul class="dropdown-menu" role="menu" aria-labelledby="font-family-X">
									<li><a tabindex="-1" href="#" onclick="setFont('Arial');" class="Arial">Arial</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Helvetica');" class="Helvetica">Helvetica</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Myriad Pro');" class="MyriadPro">Myriad Pro</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Delicious');" class="Delicious">Delicious</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Verdana');" class="Verdana">Verdana</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Georgia');" class="Georgia">Georgia</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Courier');" class="Courier">Courier</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Comic Sans MS');" class="ComicSansMS">Comic Sans MS</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Impact');" class="Impact">Impact</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Monaco');" class="Monaco">Monaco</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Optima');" class="Optima">Optima</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Hoefler Text');" class="Hoefler Text">Hoefler Text</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Plaster');" class="Plaster">Plaster</a></li>
									<li><a tabindex="-1" href="#" onclick="setFont('Engagement');" class="Engagement">Engagement</a></li>
								</ul>
								<button id="text-bold" class="btn" data-original-title="Bold"><img src="img/font_bold.png" height="" width=""></button>
								<button id="text-italic" class="btn" data-original-title="Italic"><img src="img/font_italic.png" height="" width=""></button>
								<button id="text-strike" class="btn" title="Strike" style=""><img src="img/font_strikethrough.png" height="" width=""></button>
								<button id="text-underline" class="btn" title="Underline" style=""><img src="img/font_underline.png"></button>
								<a class="btn" href="#" rel="tooltip" data-placement="top" data-original-title="Цвет текста">
									<input type="hidden" id="text-fontcolor" class="color-picker" size="7" value="#000000">
								</a>
								<a class="btn" href="#" rel="tooltip" data-placement="top" data-original-title="Цвет рамки">
									<input type="hidden" id="text-strokecolor" class="color-picker" size="7" value="#000000">
								</a>
								<!--- Background <input type="hidden" id="text-bgcolor" class="color-picker" size="7" value="#ffffff"> --->
							</div>
							<div class="pull-right" align="" id="imageeditor" style="display:none">
								<div class="btn-group">
									<button class="btn" id="bring-to-front" title="Спереди"><i class="icon-fast-backward rotate" style="height:19px;"></i></button>
									<button class="btn" id="send-to-back" title="Send to Back"><i class="icon-fast-forward rotate" style="height:19px;"></i></button>
									<button id="flip" type="button" class="btn" title="Show Back View"><i class="icon-retweet" style="height:19px;"></i></button>
									<button id="remove-selected" class="btn" title="Delete selected item"><i class="icon-trash" style="height:19px;"></i></button>
								</div>
							</div>
						</div>
					</div>
					<!--	EDITOR      -->
					<button id="flipback" type="button" class="btn" title="Rotate View" data-original-title="Show Back View"><i class="icon-retweet" style="height:19px;"></i></button>
					<div id="shirtDiv" class="page" style="width: 530px; height: 630px; position: relative; background-color: rgb(255, 255, 255);"> <img name="tshirtview" id="tshirtFacing" src="img/crew_front.png">
						<div id="drawingArea" style="position: absolute;top: 100px;left: 160px;z-index: 10;width: 200px;height: 400px;">
							<canvas id="tcanvas" width="200" height="400" class="hover" style="-webkit-user-select: none;"></canvas>
						</div>
					</div>
					<!--					<div id="shirtBack" class="page" style="width: 530px; height: 630px; position: relative; background-color: rgb(255, 255, 255); display:none;">-->
					<!--						<img src="img/crew_back.png"></img>-->
					<!--						<div id="drawingArea" style="position: absolute;top: 100px;left: 160px;z-index: 10;width: 200px;height: 400px;">					-->
					<!--							<canvas id="backCanvas" width="200" height="400" class="hover" style="-webkit-user-select: none;"></canvas>-->
					<!--						</div>-->
					<!--					</div>						-->
					<!--	/EDITOR		-->
				</div>
				<div class="span2">
					<div class="well">
						<h3>Выберите размер</h3>
						<p>
							<table class="table">
								<tr>
									<td>
										<input type="checkbox">&emsp;S</td>
								</tr>
								<tr>
									<td>
										<input type="checkbox">&emsp;M</td>
								</tr>
								<tr>
									<td>
										<input type="checkbox">&emsp;L</td>
								</tr>
								<tr>
									<td>
										<input type="checkbox">&emsp;XL</td>
								</tr>
								<tr>
									<td>
										<input type="checkbox">&emsp;XXL</td>
								</tr>
							</table>
						</p>
						<button type="button" class="btn btn-large btn-block btn-success" name="addToTheBag" id="addToTheBag">Заказать <i class="icon-briefcase icon-white"></i></button>
						<button id="take_screenshoot">Take Screenshot</button>
					</div>
				</div>
			</div>
		</div>
		</section>
		<section style="display: none;" id="screen"> </section>
	</div>

	

	<script>
		//Создание скриншота передней и задней части футболки
		function createScreenShots() {
			html2canvas(document.querySelector("#shirtDiv")).then(canvas => {
				document.querySelector("#screen").appendChild(canvas);

				dataURL = canvas.toDataURL();
				post_data(dataURL);
			});
		}

		//перевертывание футболки
		function rotateShit() {
			if(valueSelect === "img/crew_front.png") {
				if($('#flipback').attr("data-original-title") == "Show Back View") {
					$('#flipback').attr('data-original-title', 'Show Front View');
					$("#tshirtFacing").attr("src", "img/crew_back.png");
					a = JSON.stringify(canvas);
					canvas.clear();
					try {
						var json = JSON.parse(b);
						canvas.loadFromJSON(b);
					} catch(e) {}
				} else {
					$('#flipback').attr('data-original-title', 'Show Back View');
					$("#tshirtFacing").attr("src", "img/crew_front.png");
					b = JSON.stringify(canvas);
					canvas.clear();
					try {
						var json = JSON.parse(a);
						canvas.loadFromJSON(a);
					} catch(e) {}
				}
			}
			canvas.renderAll();
			canvas.calcOffset();
		}

		//кнопка создания скриншота
		$('#take_screenshoot').click(function() {
			createScreenShots(); // 1 часть скриншота
			rotateShit();

			setTimeout(function() {
				createScreenShots();// 2 часть скриншота
			}, 1000);
		});

		//Отправка скриншота на сервер
		function post_data(imageURL) {
			$.ajax({
				url: "/constructorT-Shirt/phpModules/uploadScreen.php",
				type: "POST",
				data: {
					image: imageURL
				},
				dataType: "html",
				success: function() {
					console.log("Success!!");
				}
			});
		}

		$(document).ready(function() {
			$("#tshirttype").change(function() {
				$("img[name=tshirtview]").attr("src", $(this).val());
			});
		});

		var files; // переменная. будет содержать данные файлов

		// заполняем переменную данными, при изменении значения поля file 
		$('input[type=file]').on('change', function() {
			files = this.files;
		});

		// обработка и отправка AJAX запроса при клике на кнопку upload_files
		$('.upload_files').on('click', function(event) {
			event.stopPropagation(); // остановка всех текущих JS событий
			event.preventDefault(); // остановка дефолтного события для текущего элемента - клик для <a> тега
			// ничего не делаем если files пустой
			if(typeof files == 'undefined') return;
			// создадим объект данных формы
			var data = new FormData();
			// заполняем объект данных файлами в подходящем для отправки формате
			$.each(files, function(key, value) {
				data.append(key, value);
			});
			// добавим переменную для идентификации запроса
			data.append('my_file_upload', 1);
			// AJAX запрос
			$.ajax({
				url: '/constructorT-Shirt/phpModules/uploadImage.php',
				type: 'POST', // важно!
				data: data,
				cache: false,
				dataType: 'json',
				// отключаем обработку передаваемых данных, пусть передаются как есть
				processData: false,
				// отключаем установку заголовка типа запроса. Так jQuery скажет серверу что это строковой запрос
				contentType: false,
				// функция успешного ответа сервера
				success: function(respond, status, jqXHR) {
					// ОК - файлы загружены
					if(typeof respond.error === 'undefined') {
						var html = respond.name + '<br>';
						$('#blah').attr('src', '/constructorT-Shirt/phpModules/uploads/' + respond.name);
						$('#blah').trigger('click')
						$('.ajax-reply').html(html);
					}
					// ошибка
					else {
						console.log('ОШИБКА: ' + respond.data);
					}
				},
				// функция ошибки ответа сервера
				error: function(jqXHR, status, errorThrown) {
					console.log('ОШИБКА AJAX запроса: ' + status, jqXHR);
				}
			});
		});

		//событие клика по загруженной картинке, для применения к футболке
		$(".img-polaroid2").click(function(e) {
			var el = e.target;
			var offset = 50;
			var left = fabric.util.getRandomInt(0 + offset, 200 - offset);
			var top = fabric.util.getRandomInt(0 + offset, 400 - offset);
			var angle = fabric.util.getRandomInt(-20, 40);
			var width = fabric.util.getRandomInt(30, 50);
			var opacity = (function(min, max) {
				return Math.random() * (max - min) + min;
			})(0.5, 1);
			fabric.Image.fromURL(el.src, function(image) {
				var elWidth = image.naturalWidth || image.width;
				var elHeight = image.naturalHeight || image.height;
				image.set({
					left: left,
					top: top,
					angle: 0,
					padding: 10,
					cornersize: 10,
					hasRotatingPoint: true,
					scaleX: 1 / elWidth,
					scaleY: 1 / elHeight
				});

				canvas.add(image).renderAll();
			});
		});

		var valueSelect = $("#tshirttype").val();
		$("#tshirttype").change(function() {
			valueSelect = $(this).val();
		});

		//БЫЛО перевертывание картинки
		$('#flipback').click(function() {
			rotateShit();
		});
	</script>
	<script src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/tshirtEditor.js"></script>
	<script type="text/javascript" src="js/jquery.miniColors.min.js"></script>
	<script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>